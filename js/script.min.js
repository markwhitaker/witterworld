"use strict";$(function(){const t="#F0F0F0",n="#555555",o=["#00C4F0","#00BCE5","#00B3DB","#00ABD1","#00A3C7"];let i,r={},e,l,s=11;const c=[{count:2,countries:["CH","IS"]},{count:3,countries:["CH","IS","RO"]},{count:6,countries:["CH","IS","RO","IT","PL","IQ"]},{count:7,countries:["CH","IS","RO","IT","PL","IQ","MT"]},{count:10,countries:["CH","IS","RO","IT","PL","IQ","MT","DK","TR","AT"]},{count:16,countries:["CH","IS","RO","IT","PL","IQ","MT","DK","TR","AT","AS","CA","GB-SCT","SE","VE","PG"]},{count:21,countries:["CH","IS","RO","IT","PL","IQ","MT","DK","TR","AT","AS","CA","GB-SCT","SE","VE","PG","AU","BM","CN","DE","MX"]},{count:27,countries:["CH","IS","RO","IT","PL","IQ","MT","DK","TR","AT","AS","CA","GB-SCT","SE","VE","PG","AU","BM","CN","DE","MX","AR","CZ","JM","NG","NO","GB-WLS"]},{count:30,countries:["CH","IS","RO","IT","PL","IQ","MT","DK","TR","AT","AS","CA","GB-SCT","SE","VE","PG","AU","BM","CN","DE","MX","AR","CZ","JM","NG","NO","GB-WLS","KP","BT","FI"]},{count:34,countries:["CH","IS","RO","IT","PL","IQ","MT","DK","TR","AT","AS","CA","GB-SCT","SE","VE","PG","AU","BM","CN","DE","MX","AR","CZ","JM","NG","NO","GB-WLS","KP","BT","FI","PT","MN","LB","ZA"]},{count:46,countries:["CH","IS","RO","IT","PL","IQ","MT","DK","TR","AT","AS","CA","GB-SCT","SE","VE","PG","AU","BM","CN","DE","MX","AR","CZ","JM","NG","NO","GB-WLS","KP","BT","FI","PT","MN","LB","ZA","HU","GE","GT","IE","ES","GR","CL","NL","TW","IN"]},{count:52,countries:null}];var u;function a(){(i=new jvm.Map({map:"world_merc",container:$("#map"),backgroundColor:t,zoomMin:.9,focusOn:{x:.5,y:.5,scale:.95},series:{regions:[{attribute:"fill"}]},onRegionClick:(t,e)=>T(e),onRegionTipShow:(t,e,o)=>{o=M()[o];o&&e.text(`${o.country}: ${o.title} (${o.year})`)}})).series.regions[0].setValues(function(){var t=M();var e={};for(var o in i.regions)e[o]=t[o]?t[o].colour:n;return e}())}function m(){i&&(i.remove(),i=void 0)}function d(){C("#listCountries",A().sort((t,e)=>t.country<e.country?-1:t.country>e.country?1:0),t=>t.country,t=>`${t.title} (${t.year})`)}function g(){C("#listFilms",A().sort((t,e)=>{t=t.title.sortable(),e=e.title.sortable();return t<e?-1:e<t?1:0}),t=>`${t.title} (${t.year})`,t=>t.country)}function C(e,t,o,n){$(e).empty(),t.forEach(t=>{$("<span></span>").addClass("listFilm").prop({title:n(t),style:"background-color: "+t.colour}).text(o(t)).click(()=>T(t.countryCode)).prepend($("<img/>").prop({src:S(t),alt:w(t)})).appendTo(e)})}function f(){var t=A();$("#filmCount").text(t.length)}function p(t){$(t).addClass("selected").siblings().removeClass("selected")}function h(t){$(t).show().siblings().hide()}function T(t){t=M()[t];t&&($("#filmCountry").text(t.country),$("#filmTitle").text(t.title),$("#filmYear").text(t.year),$("#filmCountryFlag").prop({src:S(t),alt:w(t)}),$("#filmImageContainer").toggleClass("defaultImage",!t.image),$("#filmImage").prop({src:t.image,alt:`Film poster for ${t.title} (${t.year})`}).toggle(!!t.image),$("#filmOriginalTitle").text(t.originalTitle).toggle(!!t.originalTitle),$("#imdbLink").toggle(!!t.imdb).prop({href:`https://www.imdb.com/title/${t.imdb}/`}),$("#letterboxdLink").toggle(!!t.letterboxd).prop({href:`https://letterboxd.com/film/${t.letterboxd}/`}),$("#rottenTomatoesLink").toggle(!!t.rottenTomatoes).prop({href:"https://www.rottentomatoes.com/m/"+t.rottenTomatoes}),$("#wikipediaLink").toggle(!!t.wikipedia).prop({href:"https://en.wikipedia.org/wiki/"+t.wikipedia}),$("#justwatchLink").toggle(!!t.justwatch).prop({href:"https://www.justwatch.com/uk/movie/"+t.justwatch}),$("#trailerLink").toggle(!!t.trailer).prop({href:"https://youtu.be/"+t.trailer}),$("#reviewLink").toggle(!!t.review).prop({href:"https://youtu.be/"+t.review}),$("#filmReviewer").text(t.reviewer),$("#filmDetailsModal").modal())}function S(t){return`https://flagcdn.com/${t.countryCode.toLowerCase()}.svg`}function w(t){return"National flag of "+t.country}function I(t){var e=(s=t)/(c.length-1)*100,e=($("#timelineHandle").css("left",e+"%"),$("#timelineProgress").css("width",e+"%"),$(".timeline-dot").removeClass("active"),$(`.timeline-dot[data-index="${t}"]`).addClass("active"),c[t]);$("#timelineCountryCount").text(e.count),f(),i&&(m(),a()),d(),g()}function A(){const e=c[s];return e.countries?Object.values(r).filter(t=>e.countries.includes(t.countryCode)):Object.values(r)}function M(){var t=c[s];if(!t.countries)return r;const e={};return t.countries.forEach(t=>{r[t]&&(e[t]=r[t])}),e}$("a").prop("target","_blank"),$("#btnShowMap").click(()=>{p("#btnShowMap"),h("#sectionMap"),a()}),$("#btnShowListCountries").click(()=>{p("#btnShowListCountries"),h("#sectionListCountries"),m()}),$("#btnShowListFilms").click(()=>{p("#btnShowListFilms"),h("#sectionListFilms"),m()}),$("#btnShowAbout").click(()=>{p("#btnShowAbout"),h("#sectionAbout"),m()}),$("#filmCountryFlag").on({error:function(){$(this).hide()},load:function(){$(this).show()}}),u=()=>{f();{const i=$("#timelineTrack"),r=$("#timelineDots"),l=$("#timelineHandle");$("#timelineProgress"),r.empty(),c.forEach((t,e)=>{var o=$("<div></div>").addClass("timeline-dot").attr("data-index",e).css("left",e/(c.length-1)*100+"%").click(()=>I(e));r.append(o)}),I(s);let e=!1;function o(t){var e=i[0].getBoundingClientRect(),t=t.clientX||t.touches&&t.touches[0].clientX;return Math.max(0,Math.min(1,(t-e.left)/e.width))}function n(t){t=Math.round(t*(c.length-1));t!==s&&I(t)}l.on("mousedown",t=>{e=!0,l.addClass("dragging"),t.preventDefault()}),l.on("touchstart",t=>{e=!0,l.addClass("dragging"),t.preventDefault()}),i.on("click",t=>{e||n(o(t))}),$(document).on("mousemove",t=>{e&&n(o(t))}),$(document).on("touchmove",t=>{e&&(t.preventDefault(),n(o(t)))}),$(document).on("mouseup touchend",()=>{e&&(e=!1,l.removeClass("dragging"))})}a(),d(),g()},e=[],l=[],r={},$.getJSON("data/films.json",t=>{t.forEach(t=>{var e;t.colour=(e=Math.floor(Math.random()*o.length),o[e]),r[t.countryCode]=t}),e=t.sort((t,e)=>t.country<e.country?-1:t.country>e.country?1:0),l=t.slice().sort((t,e)=>{t=t.title.sortable(),e=e.title.sortable();return t<e?-1:e<t?1:0}),u()}),String.prototype.sortable=function(){return this.replace(/^(A|The) /,"")}});